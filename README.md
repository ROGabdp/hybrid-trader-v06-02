# ğŸš€ Hybrid Trading System V4.1 (Hybrid Optimized) for Taiwan Stock Index (^TWII)

é€™æ˜¯ä¸€å€‹å…ˆé€²çš„æ¼”ç®—æ³•äº¤æ˜“ç³»çµ±ï¼Œçµåˆäº†ç”¨æ–¼åƒ¹æ ¼é æ¸¬çš„ **LSTM-SSAM** (Long Short-Term Memory with Sequential Self-Attention) ä»¥åŠç”¨æ–¼äº¤æ˜“æ±ºç­–çš„ **Pro Trader RL** (Reinforcement Learning)ã€‚


# hybrid-trader-v06-02 æ˜¯ä»¥ hybrid-trader-v06 ä½œç‚ºåŸºç¤ä¾†ä¿®æ”¹çš„

# v06-02 é‡é»

1. æ”¹è®Šè¨“ç·´é›†å’Œé©—è­‰é›†çš„åˆ‡åˆ†æ™‚é–“é»ã€‚

    è¨“ç·´é›†ä½¿ç”¨ä»¥ä¸‹æ—¥æœŸæœŸé–“ 
    --start 2000-01-01 --end 2017-10-15
    --start 2023-10-16 --end 2025-12-31

    é©—è­‰é›†ä½¿ç”¨ä»¥ä¸‹æ—¥æœŸæœŸé–“
    --start 2017-10-16 --end 2023-10-15

2. å°‡buy agent åœ¨é©—è­‰é›†æœŸé–“çš„é¡åˆ¥å¹³è¡¡å–æ¶ˆï¼Œä»¥å¾—åˆ°çœŸæ­£å¯ä»¥åœ¨ä¸åŒå¸‚å ´å­˜æ´»çš„æœ€ä½³æ¨¡å‹

    ğŸ“Š Agent è¨“ç·´åƒæ•¸ç¸½è¡¨ (train_v5_models.py) æ–¼v06å·²ç¶“èª¿æ•´å¥½ï¼Œå› æ­¤ä¸éœ€è¦ä¿®æ”¹
    éšæ®µ	Agent	1. è©•ä¼°å›æ•¸ (n_eval_episodes)	2. ç†µä¿‚æ•¸ (ent_coef)	3. å­¸ç¿’ç‡ (learning_rate)	ç¨‹å¼ç¢¼è¡Œæ•¸
    Pre-training	Buy Agent	50	0.01	0.0001 (1e-4)	L175 / L150 / L147
    Pre-training	Sell Agent	50	0.01	0.0001 (1e-4)	L210 / L150 / L147
    Fine-tuning	Buy Agent	100	0.01	0.000005 (5e-6)	L336 / L299 / L296
    Fine-tuning	Sell Agent	100	0.01	0.000005 (5e-6)	L384 / L299 / L296

    é€™æ¬¡çš„è¨“ç·´æ˜¯æˆåŠŸçš„ã€‚
    1. é©—è­‰äº† Gap Validationï¼šAgent åœ¨æ²’æœ‰çœ‹éçš„å¸‚å ´ç‰‡æ®µ (2017-2023) ä¸­è¡¨ç¾ç©©å¥ï¼Œæ²’æœ‰éæ“¬åˆã€‚
    2. è­‰å¯¦äº† Remove Class Balancingï¼šè®“ Agent ç›´æ¥é¢å°çœŸå¯¦æ•¸æ“šåˆ†ä½ˆæ˜¯æ­£ç¢ºçš„ï¼Œå®ƒå­¸æœƒäº†ã€Œå¯§å¯éŒ¯éå¹³åº¸æ©Ÿæœƒï¼ŒåªæŠ“æ¥µç«¯å¥½æ©Ÿæœƒã€çš„ç”Ÿå­˜ç­–ç•¥ã€‚

# hybrid-trader-v06 æ˜¯ä»¥ hybrid-trader-v03-04-03-test2-no120-x2-buy120 ä½œç‚ºåŸºç¤ä¾†ä¿®æ”¹çš„

# v06 é‡é»

1. ç§»é™¤ LSTM ç‰¹å¾µ (ç”±35å€‹ç‰¹å¾µï¼Œé™è‡³31 å€‹ç‰¹å¾µ)
2. å¼·åˆ¶ CPU è¨“ç·´ (åœ¨train_v5_models.pyä¸­)
3. èª¿æ•´sell agentçš„å­¸ç¿’ç›®æ¨™
4. èª¿æ•´è¨“ç·´å’Œé©—è­‰çš„è¶…åƒæ•¸è¨­å®šï¼Œè®“è©•ä¼°æ›´ç©©å®šï¼Œä¸”æœ€çµ‚é¸å‡ºçš„æ¨¡å‹æœƒæ›´æœ‰ä»£è¡¨æ€§ã€‚
5. å°å…¥ä»£ç†äººå…±è­˜æ©Ÿåˆ¶


# é‡å°v5æ¨¡å‹ï¼Œæ­é…äº†ç‰›ç†ŠMA120æ¿¾ç¶²ï¼Œæ›´æ–°äº†å›æ¸¬è…³æœ¬å’Œæ¯æ—¥é‹ç‡Ÿè…³æœ¬:

    * ç›¤å¾Œ
    python backtest_v5_dca_hybrid_dynamic_filter_fixed_lstm.py --start 2025-12-09
    python daily_ops_v5_dynamic_filter_fixed_lstm.py   
    * ç›¤ä¸­
    python daily_ops_v5_intraday_dynamic_filter_fixed_lstm.py -i

# ç§»é™¤LSTMä¹‹å¾Œï¼Œsell agentçš„è³£å‡ºåˆ¤æ–·è®Šå·®ï¼Œå› æ­¤æˆ‘å€‘å°sell agentçš„å­¸ç¿’ç›®æ¨™é€²è¡Œèª¿æ•´ã€‚

å®Œæˆ ptrl_hybrid_system.py ä¸­ SellEnvHybrid çš„ä¿®æ”¹ï¼š

è®Šæ›´æ‘˜è¦ï¼š

1. éš¨æ©ŸåŒ– Episode é•·åº¦ï¼šreset() æ™‚éš¨æ©Ÿé¸æ“‡ 60~250 å¤©ä½œç‚ºæœ¬å›åˆçµæŸé»ã€‚
2. è§£è€¦çå‹µè¦–çª— (Lookahead)ï¼šç„¡è«–åœ¨å“ªä¸€å¤©çµç®—ï¼Œç³»çµ±éƒ½æœƒå¾€å¾Œçœ‹å›ºå®š 60 å¤©ä¾†è¨ˆç®—ã€ŒéŒ¯éé«˜é»ã€åŠã€Œèº²éå¤§è·Œã€çš„çå‹µ/æ‡²ç½°ã€‚å³ä½¿è¢«éš¨æ©Ÿè¸¢å‡ºå±€ï¼Œä¹Ÿç„¡æ³•å…æ–¼è¢«è©•åƒ¹å¾ŒçºŒèµ°å‹¢ã€‚
3. è³‡æ–™åˆ‡ç‰‡æ“´å¤§ï¼šæ¯å€‹ Episode çš„è³‡æ–™å¾ 120 å¤©å¢åŠ åˆ° 310 å¤©ï¼Œä»¥å®¹ç´æœ€é•· 250 å¤©çš„ Episode åŠ ä¸Š 60 å¤©çš„ Lookaheadã€‚
4. æ ¸å¿ƒçå‹µå…¬å¼ï¼ˆåŸºç¤å ±é…¬ã€éŒ¯å¤±é«˜é»æ‡²ç½°ã€èº²éå¤§è·Œçå‹µï¼‰ç¶­æŒä¸è®Šï¼Œåªä¿®æ”¹äº†è¨ˆç®—æ‰€ç”¨çš„æ™‚é–“è¦–çª—ã€‚
5. å°å…¥ä»£ç†äººå…±è­˜æ©Ÿåˆ¶

# evl æ™‚ä¸çŸ¥é“ç‚ºä»€éº¼ï¼Œä¸€é–‹å§‹åˆ†æ•¸éƒ½æœƒé£†é«˜ï¼Œå°è‡´é›–ç„¶è·‘äº† 1M stepsï¼Œä½†æœ€å¾Œå­˜ä¸‹ä¾†çš„model å»æ˜¯å‰é¢æ²’è·‘å¹¾æ­¥çš„æ¨¡å‹ã€‚ 

èª¿æ•´ train_v5_models.py çš„åƒæ•¸ï¼Œè®“è©•ä¼°æ›´ç©©å®šï¼Œä¸”æœ€çµ‚é¸å‡ºçš„æ¨¡å‹æœƒæ›´æœ‰ä»£è¡¨æ€§ã€‚

1. å¢åŠ è©•ä¼°å›æ•¸ (n_eval_episodes)ï¼š
å¾ 30 æ”¹ç‚º 100ã€‚
æ›´å¤šçš„æ¨£æœ¬æ•¸èƒ½æ¶ˆé™¤é‹æ°£æˆåˆ†ï¼Œåªæœ‰ã€ŒçœŸçš„å¼·ã€çš„æ¨¡å‹æ‰èƒ½åœ¨ 100 æ¬¡æ¸¬è©¦ä¸­æ‹¿ä¸‹é«˜åˆ†ã€‚
2. å¢åŠ ç†µä¿‚æ•¸ (ent_coef)ï¼š
Fine-tune ç›®å‰æ˜¯ 0.005ï¼Œå»ºè­°æ”¹å› 0.01ï¼ˆèˆ‡ Pre-train ç›¸åŒï¼‰ã€‚
TensorBoard é¡¯ç¤º entropy ä¸‹é™å¾ˆå¿«ï¼ˆAgent å¤ªå¿«è®Šè‡ªä¿¡ï¼‰ã€‚æé«˜é€™å€‹ä¿‚æ•¸å¯ä»¥å¼·è¿« Agent ä¿æŒã€Œå¥½å¥‡å¿ƒã€ï¼Œä¸è¦å¤ªæ—©é–æ­»åœ¨ã€Œæ­»æŠ±ä¸è³£ã€é€™å€‹å±€éƒ¨æœ€ä½³è§£ã€‚
3. é™ä½å­¸ç¿’ç‡ (learning_rate)ï¼š
ç›®å‰æ˜¯ 1e-5ï¼Œå¯ä»¥é™ç‚º 5e-6ã€‚è®“ Fine-tune çš„æ­¥ä¼æ›´æ…¢ã€æ›´ç©©ï¼Œé¿å…ç ´å£ Pre-train å­¸åˆ°çš„çŸ¥è­˜ï¼Œä¹Ÿèƒ½æ¸›å°‘è¨“ç·´éç¨‹çš„éœ‡ç›ªã€‚

# å°å…¥ä»£ç†äººå…±è­˜æ©Ÿåˆ¶ (Agent Consensus)

ç‚ºäº†è§£æ±º Sell Agent åœ¨å¼·å‹¢ç‰›å¸‚ä¸­éæ—©è³£å‡º (Churning) çš„å•é¡Œï¼Œæˆ‘å€‘å¼•å…¥äº†ã€Œè²·æ–¹å¦æ±ºæ¬Šã€æ©Ÿåˆ¶ã€‚

**æ ¸å¿ƒé‚è¼¯ï¼š**
åœ¨è³£å‡ºæ±ºç­–åŸ·è¡Œå‰ï¼ŒåŠ å…¥ Buy Agent çš„ä¿¡å¿ƒç¢ºèªã€‚
*   å¦‚æœ `Buy_Conf > 0.8` (Consensus Threshold)ï¼Œè¡¨ç¤º AI æ¥µåº¦çœ‹å¥½å¾Œå¸‚ï¼Œæ­¤æ™‚å³ä½¿ Sell Agent ç™¼å‡ºè³£è¨Š (Confidence > 0.5)ï¼Œä¹Ÿæœƒè¢«**å¦æ±º (Veto)**ï¼Œå¼·åˆ¶æŒå€‰ã€‚
*   å”¯ä¸€ä¾‹å¤–ï¼šç¡¬æ€§åœæ (è§¸ç™¼ -8% æˆ– æ§“æ¡¿å¾Œ < 0.92) æ“æœ‰æœ€é«˜å„ªå…ˆç´šï¼Œç„¡è¦–å…±è­˜æ©Ÿåˆ¶ç›´æ¥è³£å‡ºã€‚

**é©—è­‰çµæœ (2023-2026 ç‰›å¸‚)ï¼š**
*   **äº¤æ˜“æ¬¡æ•¸**ï¼šå¾ 17 æ¬¡å¤§å¹…é™è‡³ 4 æ¬¡ï¼Œæœ‰æ•ˆæ¸›å°‘ç£¨æã€‚
*   **å¹³å‡æŒæœ‰å¤©æ•¸**ï¼šå¾ 17 å¤©å¢åŠ è‡³ 146 å¤©ï¼ŒæˆåŠŸæŠ±ä½ä¸»å‡æ®µã€‚
*   **å ±é…¬ç‡**ï¼šé©—è­‰å›æ¸¬é¡¯ç¤ºå ±é…¬ç‡å¾ +74.4% æå‡è‡³ +88.9%ã€‚
*   **ç†Šå¸‚è¡¨ç¾**ï¼šåœ¨ 2022 ç†Šå¸‚ä¸­ï¼Œå›  Buy Agent ä¿¡å¿ƒä½ï¼Œä¸æœƒè§¸ç™¼å¦æ±ºï¼ŒSell Agent ä»èƒ½æ­£å¸¸ç™¼æ®é˜²å®ˆåŠŸèƒ½ã€‚

**å·²æ›´æ–°æª”æ¡ˆï¼š**
*   å›æ¸¬è…³æœ¬ï¼š`backtest_v5_no_filter.py`, `backtest_v5_dca_hybrid_no_filter_fixed_lstm.py`, `backtest_v5_dca_hybrid_dynamic_filter_fixed_lstm.py`
*   å¯¦æˆ°è…³æœ¬ï¼š`daily_ops_v5_dynamic_filter_fixed_lstm.py`, `daily_ops_v5_intraday_dynamic_filter_fixed_lstm.py`











# v03-04-03-test2-no120-x2-buy120 é‡é»

v4æ¨¡å‹:
    åŸºæ–¼ v03-04-03-test2-no120-x2 ç‰ˆæœ¬ä¿®æ”¹ï¼Œä¸»è¦ä¿®æ”¹: 

    1.buy agentè¨“ç·´æ™‚ï¼Œç›®æ¨™æ”¹ç‚ºè²·å…¥120å¤©å…§ä¸Šæ¼²è¶…é10%ã€‚æ–°å¢ Next_120d_Max è¨ˆç®— - åœ¨ calculate_features() ä¸­è¨ˆç®— 120 å¤©å…§æœ€é«˜é»å ±é…¬ç‡
    2.ç§»é™¤å”å…¶å®‰é€šé“é™åˆ¶ - BuyEnvHybrid.__init__() ä¸å†åªçœ‹çªç ´æ—¥ï¼Œæ”¹ç‚ºæ‰€æœ‰äº¤æ˜“æ—¥éƒ½å¯è²·å…¥
    3.ä¿®æ­£æ¸¬è©¦é›†å…§æ¨£æœ¬å¹³è¡¡çš„éŒ¯èª¤ï¼Œå…ˆå‰100% åªæœƒæŠ½å–è² æ¨£æœ¬ï¼Œæ¸¬è©¦å‡ºä¾†çš„åˆ†æ•¸æ°¸é éƒ½æ˜¯ -0.5
    4.ä¿®æ­£ Next_120d_Max çš„è¨ˆç®—é‚è¼¯: åŸå§‹å…¬å¼ shift(-N).rolling(N).max() è¨ˆç®—çš„æ˜¯ã€Œå¾ T+N å¾€å›çœ‹ N å¤©ã€ï¼Œè€Œéã€Œå¾ T+1 åˆ° T+N é€™ N å¤©ã€çš„æœ€é«˜åƒ¹ã€‚

    # Buy Agent è©•ä¼°çµæœåˆ†æ
    é—œéµç™¼ç¾ï¼š

    æŒ‡æ¨™	æ•¸å€¼
    æ¸¬è©¦æœŸé–“	2017-10-16 ~ 2025-12-26 (2000 å¤©)
    è²·å…¥æ±ºç­–	100% (2000/2000) - Agent æ°¸é é¸æ“‡è²·å…¥
    è²·å…¥æˆåŠŸç‡	50.1% (1002/1999)
    Next_120d_Max_Return å¹³å‡å€¼	12.5%
    >=10% æ¯”ä¾‹	~50% (ä¸­ä½æ•¸ 10.0%)
    å•é¡Œåˆ†æï¼š

    Agent æ°¸é é¸æ“‡è²·å…¥ - é€™èªªæ˜æ¨¡å‹æ²’æœ‰å­¸æœƒã€Œä¸è²·ã€çš„ç­–ç•¥ï¼Œå¯èƒ½æ˜¯å› ç‚ºï¼š
    è¨“ç·´æ¨£æœ¬ä¸­æ­£æ¨£æœ¬æ¯”ä¾‹å¤ªé«˜ (ç´„ 47%)ï¼ŒåŠ ä¸Š 50/50 å¹³è¡¡æ¡æ¨£è®“æ¨¡å‹åå‘è²·å…¥
    è²·å…¥æ­£ç¢ºçš„çå‹µ (+2.0) å¤§æ–¼ä¸è²·æ­£ç¢ºçš„çå‹µ (+0.5)
    æ¨¡å‹å¯èƒ½éåº¦å­¸ç¿’åˆ°ã€Œè²·å°±å°äº†ã€çš„ç­–ç•¥
    50.1% æˆåŠŸç‡æ¥è¿‘éš¨æ©Ÿ - å› ç‚º 120 å¤©å…§æœ‰ ~47% çš„æ©Ÿæœƒæ¼²è¶…é 10%ï¼Œæ¨¡å‹æ°¸é è²·å…¥çš„ç­–ç•¥åªæ˜¯ç•¥å„ªæ–¼éš¨æ©Ÿ

V5æ¨¡å‹:
    
    å’Œv4æ¨¡å‹ç›¸åŒï¼Œåƒ…ä¿®æ”¹çå‹µçµæ§‹å¦‚ä¸‹:
    V5 çå‹µçµæ§‹ï¼ˆå°ç¨±è¨­è¨ˆï¼‰ï¼š

    æƒ…å¢ƒ	çå‹µ
    è²·å° (action=1, æ¼²å¹…â‰¥10%)	+1.0
    è²·éŒ¯ (action=1, æ¼²å¹…<10%)	0.0
    éŒ¯éå¥½æ©Ÿæœƒ (action=0, æ¼²å¹…â‰¥10%)	0.0
    æ­£ç¢ºè¿´é¿ (action=0, æ¼²å¹…<10%)	+1.0

    V5 Buy Agent åˆ†æçµæœ
    æŒ‡æ¨™	       V5 (å°ç¨±çå‹µ)	    V4 (éå°ç¨±çå‹µ)
    è²·å…¥æ±ºç­–æ¯”ä¾‹	33.2% (664/2000)	100% (2000/2000)
    ä¸è²·æ±ºç­–æ¯”ä¾‹	66.8% (1336/2000)	0%
    è²·å…¥æˆåŠŸç‡	    69.6% (462/664)	    50.1%
    ä¸è²·æ­£ç¢ºç‡	    59.6% (795/1335)	N/A
    æ•´é«”æº–ç¢ºç‡	    62.9%	            50.1%
    è²·å…¥å¹³å‡ä¿¡å¿ƒ	0.927        	    0.999
    ä¸è²·å¹³å‡ä¿¡å¿ƒ	0.950	            N/A
    
    é—œéµæ”¹é€²ï¼š
    âœ… V5 å­¸æœƒäº†ã€Œä¸è²·ã€ - 66.8% çš„æ™‚é–“é¸æ“‡ä¸è²·ï¼ˆV4 æ°¸é è²·å…¥ï¼‰
    âœ… è²·å…¥æˆåŠŸç‡å¤§å¹…æå‡ - å¾ 50.1% æå‡åˆ° 69.6%
    âœ… æ•´é«”æº–ç¢ºç‡æå‡ - å¾ 50.1% æå‡åˆ° 62.9%
    çµè«–ï¼š
    å°ç¨±çå‹µçµæ§‹è®“ Agent å­¸æœƒäº†æ›´è¬¹æ…çš„æ±ºç­–ï¼å®ƒä¸å†ç›²ç›®è²·å…¥ï¼Œè€Œæ˜¯æœƒåœ¨ä½ä¿¡å¿ƒåº¦æ™‚é¸æ“‡ã€Œä¸è²·ã€ï¼Œé€™ä½¿å¾—ç•¶å®ƒæ±ºå®šè²·å…¥æ™‚ï¼ŒæˆåŠŸç‡æ›´é«˜ã€‚

é‡å°v5æ¨¡å‹ï¼Œå»ºç«‹äº†å›æ¸¬è…³æœ¬å’Œæ¯æ—¥é‹ç‡Ÿè…³æœ¬:

    python backtest_v5_no_filter.py
    ç›¤å¾Œ
    python backtest_v5_dca_hybrid_no_filter_fixed_lstm.py --start 2025-12-09
    python daily_ops_v5_fixed_lstm.py
    ç›¤ä¸­
    python daily_ops_v5_intraday_fixed_lstm.py -i

ä¿®æ”¹ä»¥ä¸‹è…³æœ¬:
    daily_ops_v5_fixed_lstm.pyï¼š
        -v5_inference()æ–°å¢ open_positions å’Œ close_price åƒæ•¸
        -é‡å°æ¯ç­†çœŸå¯¦æŒå€‰è¨ˆç®—å ±é…¬ç‡ä¸¦å–å¾— Sell Agent æ±ºç­–èˆ‡ä¿¡å¿ƒ
        -å ±å‘Šä¸­ç§»é™¤ã€Œå‡è¨­æƒ…å¢ƒã€ï¼Œæ”¹ç‚ºé¡¯ç¤ºæ¯ç­†æŒå€‰çš„ AI åˆ¤æ–·
    daily_ops_v5_intraday_fixed_lstm.pyï¼š
        -ä¸ä¸Šè¿°ç›¸åŒçš„ä¿®æ”¹
    evaluate_sell_agent_performance.py(æ–°æª”æ¡ˆ)ï¼š
        -   è®€å– trades_strat2_*.csv ä¸¦è¨ˆç®— Sell Agent çš„å‹ç‡ã€ç²åˆ©å› å­ã€åœææ¯”ä¾‹ç­‰æŒ‡æ¨™

# å…¨é¢æ›´æ–° backtest_v5_dca_hybrid_dynamic_filter_fixed_lstm.pyï¼Œç¾åœ¨å®ƒï¼š

-è¼¸å‡ºæ ¼å¼å®Œå…¨å°é½ŠåŸºæº–è…³æœ¬ï¼šç”¢ç”Ÿèˆ‡ no_filter ç‰ˆæœ¬ç›¸åŒçš„æ‰€æœ‰ CSV å’Œ PNG è¼¸å‡ºã€‚
-åŒ…å« Strategy 1 (2x Leverage) å’Œ Strategy 2 (Shared Pool)ï¼šå…©å€‹ç­–ç•¥éƒ½åŠ å…¥äº†å‹•æ…‹æ¿¾ç¶²é‚è¼¯ã€‚
-å‹•æ…‹æ¿¾ç¶²é‚è¼¯ï¼š
    - ç†Šå¸‚åˆ¤å®šï¼šPrice < MA120 é€£çºŒ 3 å¤©
    - ç†Šå¸‚æ™‚å•Ÿç”¨ 10 æ—¥ Donchian Filter
    - ç‰›å¸‚æ™‚ç„¡æ¿¾ç¶²é™åˆ¶

-é—œæ–¼ ptrl_hybrid_system.py çš„ MA120 æ”¹å‹•ï¼š
    - âœ… å·²ç¢ºèªå®‰å…¨ï¼šMA120 æœªåŠ å…¥ FEATURE_COLSï¼Œä¸æœƒå½±éŸ¿æ¨¡å‹è¨“ç·´æˆ–å…¶ä»–å›æ¸¬è…³æœ¬ã€‚

# é‡å°v5æ¨¡å‹ï¼Œæ­é…äº†ç‰›ç†ŠMA120æ¿¾ç¶²ï¼Œå»ºç«‹äº†å›æ¸¬è…³æœ¬å’Œæ¯æ—¥é‹ç‡Ÿè…³æœ¬:

    * ç›¤å¾Œ
    python backtest_v5_dca_hybrid_dynamic_filter_fixed_lstm.py --start 2025-12-09
    python daily_ops_v5_dynamic_filter_fixed_lstm.py   
    * ç›¤ä¸­
    python daily_ops_v5_intraday_dynamic_filter_fixed_lstm.py -i


# v03-04-03-test2-no120-x2 é‡é»

åŸºæ–¼ v03-04-03-test2-no120 ç‰ˆæœ¬ä¿®æ”¹ï¼Œä¸»è¦æ–°å¢å…©å¤§åŠŸèƒ½ï¼š

## 1. âœ¨ å‹•æ…‹è³‡é‡‘é…ç½® (Dynamic Fund Allocation) - Strat 1 & 2

**å•é¡Œ**ï¼šåŸå§‹ Shared Pool æ¨¡å¼ä¸­ï¼ŒAI è³£å‡ºçš„è³‡é‡‘åªæ˜¯å›åˆ° `internal_cash`ï¼Œä¸æœƒå¢åŠ å¾ŒçºŒçš„ DCA/AI è²·å…¥é‡‘é¡ï¼Œå°è‡´å¹´åº•æœ‰é–’ç½®è³‡é‡‘ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¯æœˆè²·å…¥é‡‘é¡å‹•æ…‹è¨ˆç®— (é©ç”¨æ–¼ Strat 1 & 2)

```python
# æ¯å¹´åˆæ³¨å…¥è³‡é‡‘
yearly_pool += yearly_capital  # 60 è¬

# AI è³£å‡ºæ™‚
yearly_pool += leveraged_value  # æ”¶ç›Šå›åˆ°æ± ä¸­

# æ¯æœˆåˆè¨ˆç®—è²·å…¥é‡‘é¡
remaining_months = 13 - month  # 1æœˆ=12å€‹æœˆ, 12æœˆ=1å€‹æœˆ
dynamic_chunk_amount = yearly_pool / remaining_months
```

**æ•ˆæœ**ï¼š
| æ™‚é–“é» | Pool é‡‘é¡ | æ¯å€‰é‡‘é¡ | èªªæ˜ |
|--------|-----------|----------|------|
| 2020 å¹´åˆ | $600,000 | $50,000 | æ¨™æº–é…ç½® |
| 2022 å¹´åˆ | $1,091,762 | **$90,980** | AI è³£å‡ºç´¯ç©è³‡é‡‘ |
| 2024 å¹´åˆ | $1,091,085 | **$90,924** | è¤‡åˆ©æ•ˆæ‡‰ |

---

## 2. âš¡ å¤§è·Œæ™‚ 2x æ§“æ¡¿ (Strat 1 Only)

**è§¸ç™¼æ¢ä»¶**ï¼šç•¶å¤§ç›¤å¾æ­·å²é«˜é»ä¸‹è·Œè¶…é **8%** (èˆ‡åœæé»ä¸€è‡´)

**é‹ä½œé‚è¼¯**ï¼š
- é€²å…¥ 2x æ¨¡å¼å¾Œï¼Œ**æ‰€æœ‰æ–°è²·å…¥çš„å€‰ä½** (DCA + AI) æ¼²è·Œå¹…ä»¥ 2 å€è¨ˆç®—
- ç•¶å¤§ç›¤**æ¼²å›åˆ°å•Ÿå‹• 2x æ™‚çš„åƒ¹æ ¼**ï¼Œé€€å‡ºæ§“æ¡¿æ¨¡å¼
- å·²è²·å…¥çš„ 2x å€‰ä½**ç¶­æŒæ§“æ¡¿ç›´åˆ°è³£å‡º**

```python
LEVERAGE_THRESHOLD = 0.08  # ä¸‹è·Œ 8% å•Ÿå‹•æ§“æ¡¿

# è§¸ç™¼æ¢ä»¶
if price < peak_price * (1 - LEVERAGE_THRESHOLD):
    leveraged_mode = True
    leverage_trigger_price = price

# é€€å‡ºæ¢ä»¶
if price >= leverage_trigger_price:
    leveraged_mode = False
```

**æ§“æ¡¿äº‹ä»¶çµ±è¨ˆ** (2020-2025)ï¼šå…± 12 æ¬¡å•Ÿå‹•

| å•Ÿå‹•æ—¥æœŸ | çµæŸæ—¥æœŸ | è§¸ç™¼åƒ¹æ ¼ | è·Œå¹… |
|----------|----------|----------|------|
| 2020-03-02 | 2020-03-03 | 11,170 | -8.3% |
| 2020-03-12 (COVID) | 2020-04-15 | 10,422 | -9.5% |
| 2022-09-23 | 2022-11-14 | 14,118 | -8.7% |
| ... | ... | ... | ... |

---

## 3. ğŸ¯ Benchmark æ ¡æº– (Pure DCA Optimization)

**å•é¡Œ**ï¼šPure DCA æ¯æœˆå›ºå®šè²·å…¥ $50,000ï¼Œæœƒå› ç‚ºè‚¡åƒ¹ç„¡æ³•æ•´é™¤è€Œç”¢ç”Ÿé›¶é ­ (e.g. å‰© $6,000)ï¼Œé•·æœŸç´¯ç©å°è‡´ç¸½æŠ•å…¥é‡‘é¡æ¯” Yearly Lump å°‘äº†ç´„ 15%ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æ¯å¹´ 12 æœˆåº•ï¼Œè‡ªå‹•å°‡ç´¯ç©çš„é›¶é ­ç¾é‡‘ä¸€æ¬¡è²·å…¥ã€‚
- **æ•ˆæœ**ï¼šèˆ‡ Yearly Lump çš„ç¸½æŠ•å…¥å·®è·ç¸®å°è‡³ **0.25%**ï¼Œæ¯”è¼ƒåŸºç¤æ›´å…¬å¹³ã€‚

---

## 4. ğŸ“Š æœ€çµ‚ç¸¾æ•ˆå°æ¯” (2020-2025)

**æ‰€æœ‰ç­–ç•¥è³‡é‡‘é‹ç”¨æ•ˆç‡ä¸€è‡´åŒ–**ï¼šç¸½æŠ•å…¥çš†ç‚º ~$3.6M

| ç­–ç•¥ | æŠ•å…¥è³‡é‡‘ | æœ€çµ‚å¸‚å€¼ | **ç¸½å ±é…¬ç‡** | å¹´åŒ–å ±é…¬ | Max DD |
|------|----------|----------|-------------|----------|--------|
| **Strat 1 (Dynamic + 2x)** | **$3,600,000** | **$7,094,794** ğŸ† | **+97.08%** | **12.02%** | -29.8% |
| Strat 2 (Shared Pool) | **$3,600,000** | $6,107,058 | +69.64% | 9.25% | -27.3% |
| Yearly Lump | $3,553,882 | $6,249,220 | +75.84% | 9.91% | -31.6% |
| Pure DCA | $3,544,895 | $5,967,723 | +68.35% | 9.11% | -25.2% |

### ğŸ† é—œéµçµè«–

1. **Strat 1 å¤§å‹ Yearly Lump**ï¼š
   - æœ€çµ‚å¸‚å€¼é«˜å‡º **$84.5 è¬** (+13.5%)
   - é›–ç„¶ Max DD ç•¥é«˜ï¼Œä½†å ±é…¬ç‡å®Œå…¨è£œå„Ÿäº†é¢¨éšªã€‚
   
2. **æ§“æ¡¿æ•ˆæœé¡¯è‘—**ï¼š
   - Strat 1 (æœ‰æ§“æ¡¿) æ¯” Strat 2 (ç„¡æ§“æ¡¿) å¤šè³ºäº† **$98.7 è¬**ï¼Œé€™å®Œå…¨æ­¸åŠŸæ–¼ 12 æ¬¡çš„å¤§è·Œ 2x æŠ„åº•æ“ä½œã€‚

---

## 4. ä¿®æ”¹çš„æª”æ¡ˆ

| æª”æ¡ˆ | ä¿®æ”¹å…§å®¹ |
|------|----------|
| `backtest_v4_dca_hybrid_with_filter_fixed_lstm.py` | æ–°å¢ `LeveragedSharedPoolBacktester` é¡åˆ¥å–ä»£ `DCAHybridBacktester` |

**ä¸»è¦ç¨‹å¼ç¢¼è®Šæ›´**ï¼š
- ç¬¬ 347-670 è¡Œï¼šæ–°çš„ `LeveragedSharedPoolBacktester` é¡åˆ¥
- å‹•æ…‹è³‡é‡‘é…ç½®ï¼š`yearly_pool` è®Šæ•¸å–ä»£ `external_limit + internal_cash`
- æ§“æ¡¿è¿½è¹¤ï¼š`leverage_events`, `leverage_periods` è¨˜éŒ„
- æ–°å¢è¼¸å‡ºæª”æ¡ˆï¼š`leverage_events_strat1_*.csv`, `daily_action_strat1_*.csv`

---

## 5. ä½¿ç”¨æ–¹å¼

```bash
# åŸ·è¡Œå›æ¸¬ï¼ˆé è¨­å¾ 2020-01-01 é–‹å§‹ï¼‰
python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2020-01-01

# æŒ‡å®šçµæŸæ—¥æœŸ
python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2020-01-01 --end 2024-12-31
```

**è¼¸å‡ºæª”æ¡ˆ**ï¼š
```
results_backtest_v4_dca_hybrid_with_filter_fixed_lstm/
â”œâ”€â”€ metrics_comparison_*.csv          # ç­–ç•¥ç¸¾æ•ˆå°æ¯”
â”œâ”€â”€ leverage_events_strat1_*.csv      # æ§“æ¡¿å•Ÿå‹•/çµæŸäº‹ä»¶
â”œâ”€â”€ daily_action_strat1_*.csv         # æ¯æ—¥æ“ä½œ (å«æ§“æ¡¿ç‹€æ…‹)
â”œâ”€â”€ daily_timeline_strat1_*.png       # æ™‚é–“ç·šåœ– (æ¨™ç¤º 2x æœŸé–“)
â””â”€â”€ backtest_comparison_*.png         # æ¬Šç›Šæ›²ç·šå°æ¯”åœ–
```

## 6. ğŸ‘ï¸ ç›¤ä¸­/ç›¤å¾Œç›£æ§å‡ç´š (Daily/Intraday Ops)

**åŠŸèƒ½**ï¼šåœ¨ç›¤å¾Œ (`daily_ops_v4_fixed_lstm.py`) èˆ‡ç›¤ä¸­ (`daily_ops_v4_intraday_fixed_lstm.py`) å ±å‘Šä¸­ï¼ŒåŒæ­¥é¡¯ç¤º Strategy 1 çš„ 2x æ§“æ¡¿ç‹€æ…‹ã€‚

**é¡¯ç¤ºè³‡è¨Š**ï¼š
- **æ§“æ¡¿ç‹€æ…‹**ï¼š`ğŸ”¥ ON (2x)` æˆ– `â„ï¸ OFF (1x)`
- **æ­·å²é«˜é» (Peak)**ï¼šç›®å‰è¿½è¹¤çš„æœ€é«˜åƒ¹ (Strategy 1 é‚è¼¯)
- **è§¸ç™¼/é€€å‡ºé»ä½**ï¼š
  - æœªå•Ÿå‹•æ™‚ï¼šé¡¯ç¤ºè§¸ç™¼åƒ¹ (Peak * 92%) èˆ‡è·é›¢
  - å·²å•Ÿå‹•æ™‚ï¼šé¡¯ç¤ºé€€å‡ºåƒ¹ (Peak) èˆ‡è·é›¢

**ç¯„ä¾‹è¼¸å‡º**ï¼š
```text
âš¡ [2x æ§“æ¡¿ç›£æ§] (Strategy 1)
   ç‹€æ…‹: ğŸ”¥ ON (2å€æ§“æ¡¿)
   é«˜é»: 28,400.73 | ç›®å‰è·Œå¹…: -10.50%
   é€€å‡º: 28,400.73 (å›åˆ°é«˜é»å³é€€å‡º)
```


# v03-04-03-test2-no120 é‡é»

åŸºæ–¼ v03-04-03-test2 ç‰ˆæœ¬ä¿®æ”¹ï¼Œä¸»è¦è®Šæ›´ï¼š**ç§»é™¤ 120 å¤©å¼·åˆ¶è³£å‡ºé™åˆ¶** + **é‡æ–°è¨­è¨ˆ Sell Agent çå‹µæ©Ÿåˆ¶**ã€‚

## 1. ç§»é™¤ 120 å¤©å¼·åˆ¶è³£å‡ºé™åˆ¶

**å•é¡Œ**ï¼šåŸå§‹ Sell Agent æœƒåœ¨æŒæœ‰ 120 å¤©å¾Œå¼·åˆ¶è³£å‡ºï¼Œä¸è«– AI åˆ¤æ–·æˆ–å¸‚å ´ç‹€æ³ã€‚

**ä¿®æ”¹å…§å®¹**ï¼šå¾æ‰€æœ‰å›æ¸¬è…³æœ¬ä¸­ç§»é™¤ `hold_days >= 120` æ¢ä»¶ï¼š

| æª”æ¡ˆ | ä¿®æ”¹ä½ç½® |
|------|----------|
| `backtest_v4_dca_hybrid_with_filter_rolling_lstm.py` | ç¬¬ 300, 494 è¡Œ |
| `backtest_v4_dca_hybrid_with_filter_fixed_lstm.py` | ç¬¬ 436, 638 è¡Œ |
| `backtest_v4_with_filter.py` | ç¬¬ 160-177 è¡Œ |
| `backtest_v4_with_filter_rolling_lstm.py` | ç¬¬ 254-271 è¡Œ |
| `backtest_v4_dca_hybrid_no_filter.py` | ç¬¬ 198, 368 è¡Œ |
| `backtest_v4_dca_hybrid_no_filter_rolling_lstm.py` | ç¬¬ 296, 480 è¡Œ |
| `backtest_v4_no_filter.py` | ç¬¬ 151-168 è¡Œ |
| `backtest_v4_no_filter_rolling_lstm.py` | ç¬¬ 261-276 è¡Œ |
| `ptrl_hybrid_system.py` (`HybridBacktester`) | ç¬¬ 1032 è¡Œ |

**ä¿®æ”¹å¾Œ**ï¼šSell Agent åªæœƒåœ¨ä»¥ä¸‹æ¢ä»¶è³£å‡ºï¼š
- AI åˆ¤æ–·è³£å‡º (`action[0] == 1`)
- åœæ -8% (`current_return < 0.92`)

---

## 2. Sell Agent çå‹µæ©Ÿåˆ¶é‡æ–°è¨­è¨ˆ (Plan C)

**å•é¡Œ**ï¼šåŸå§‹çå‹µæ©Ÿåˆ¶å°è‡´ Agent å­¸æœƒã€Œæ°¸é ä¸è³£ã€ã€‚

**æ–°çš„çå‹µé‚è¼¯** (`SellEnvHybrid.step()`)ï¼š

```python
if action == 1 or self.day >= 119:  # è³£å‡º
    # 1. åŸºç¤çå‹µï¼šç•¶å‰å ±é…¬ (ç²åˆ© 10% = +1.0)
    base_reward = (current_return - 1.0) * 10
    
    # 2. éŒ¯éé«˜é»æ‡²ç½° / è³£åœ¨é«˜é»çå‹µ
    if future_max > current_return + 0.01:  # æœªä¾†é‚„æœƒæ¼² >1%
        penalty = (future_max - current_return) * 2
    else:
        penalty = -0.5  # è³£åœ¨é«˜é»ï¼çå‹µ
    
    # 3. èº²éå¤§è·Œçå‹µ
    if future_min < current_return - 0.05:  # æœªä¾†æœƒè·Œ >5%
        bonus = (current_return - future_min) * 5
    else:
        bonus = 0
    
    reward = base_reward - penalty + bonus

else:  # æŒæœ‰
    # å‹•æ…‹æŒæœ‰æ‡²ç½°ï¼ˆæº«å’Œç‰ˆï¼‰
    if current_return >= 1.10:    # å·²ç²åˆ© â‰¥10%
        reward = -0.01            # è¼•å¾®æ‡²ç½°
    elif current_return >= 1.05:  # ç²åˆ© 5-10%
        reward = -0.002           # éå¸¸è¼•å¾®
    else:                          # <5% æˆ–è™§æ
        reward = 0.0              # ä¸æ‡²ç½°
```

**è¨­è¨ˆç›®æ¨™**ï¼š
- âœ… è³£åœ¨é«˜é»ï¼šéŒ¯éæ¼²å¹…æœƒè¢«æ‡²ç½°ï¼Œè³£åœ¨æœ€é«˜é»æœ‰é¡å¤–çå‹µ
- âœ… èº²éå¤§è·Œï¼šè³£å‡ºå¾Œè‚¡åƒ¹å¤§è·Œæœƒç²å¾—é¡å¤–çå‹µ
- âœ… å‹•æ…‹æŒæœ‰æˆæœ¬ï¼šç²åˆ©è¶Šå¤šï¼ŒæŒæœ‰æ‡²ç½°è¶Šé‡ï¼Œé¼“å‹µé©æ™‚è³£å‡º

---

## 3. ç¸¾æ•ˆè¡¨ç¾ (backtest_v4_with_filter)

| æŒ‡æ¨™ | æ•¸å€¼ | è©•åƒ¹ |
|------|------|------|
| ç¸½äº¤æ˜“æ¬¡æ•¸ | 7 ç­† | âœ… åˆç† |
| å¹³å‡æŒæœ‰å¤©æ•¸ | **77 å¤©** | âœ… èƒ½æŠ“ä½æ³¢æ®µ |
| å¹³å‡å ±é…¬ç‡ | **+10.36%** | âœ… å„ªç§€ |
| å‹ç‡ | **85.7%** (6/7) | âœ… éå¸¸å¥½ |

**äº¤æ˜“æ˜ç´°**ï¼š
| è²·å…¥æ—¥ | è³£å‡ºæ—¥ | å ±é…¬ç‡ | æŒæœ‰å¤©æ•¸ |
|--------|--------|--------|---------|
| 2023-01-09 | 2024-04-08 | +38.4% ğŸŒŸ | 294 |
| 2024-04-09 | 2024-06-18 | +9.4% | 48 |
| 2024-08-19 | 2024-08-20 | +0.09% | 1 |
| 2024-09-19 | 2024-10-21 | +6.8% | 19 |
| 2024-12-04 | 2025-03-31 | -11.0% âŒ | 74 |
| 2025-04-28 | 2025-09-15 | +26.6% ğŸŒŸ | 98 |
| 2025-09-16 | 2025-09-24 | +2.2% | 6 |

---

## 4. è¨“ç·´è¨­å®š

```python
PRETRAIN_SELL_STEPS = 500_000
FINETUNE_SELL_STEPS = 500_000  # æœ€ä½³é»ç´„åœ¨ 450K
```

**TensorBoard è§€å¯Ÿ**ï¼š
- Fine-tune eval åœ¨ ~450K é”åˆ°å³°å€¼å¾Œä¸‹é™ (éæ“¬åˆ)
- EvalCallback å·²ä¿å­˜æœ€ä½³æ¨¡å‹

---

# v03-04-03-test2é‡é» (ç›®å‰ç¸¾æ•ˆæœ€å¥½ç‰ˆæœ¬)

æ²¿ç”¨:
- ç”±å‰ä¸€ç‰ˆ v03-04-03 å‡ç´šï¼Œæ²¿ç”¨è¼ƒç©æ¥µçš„buy agentï¼Œæ˜¯è¿½æ±‚ç²åˆ©çš„ç‰ˆæœ¬ã€‚ 
- æ²¿ç”¨å…ˆå‰çš„ fixed_lstm æ¯æ—¥å›æ¸¬å’Œç›¤ä¸­è§€æ¸¬AIå¯èƒ½äº¤æ˜“æ¨¡å¼ï¼Œä¸¦è‡¨æ‘¹ä¹‹ã€‚

æ›´æ–°
- ç¨ç«‹ Agent æª¢æŸ¥ï¼šBuy å’Œ Sell æ¨¡å‹åˆ†é–‹æª¢æŸ¥æ˜¯å¦å­˜åœ¨
- ä½¿ç”¨æœ€ä½³æ¨¡å‹ï¼šè¨“ç·´çµæŸå¾Œè¤‡è£½ best_model.zip ç‚º base.zip / final.zip
- é€™å€‹ç‰ˆæœ¬ä¸»è¦ å¢åŠ  KD/ MACD åˆ°RLçš„è¨“ç·´ç•¶ä¸­ï¼Œä¸¦ç§»é™¤T+20å’Œå…¶ä¿¡å¿ƒ ç‰¹å¾µ

ç¸¾æ•ˆ  (ä»¥backtest_v4_with_filterå›æ¸¬ V03-04-03-test2):
æ ¸å¿ƒç¸¾æ•ˆæŒ‡æ¨™
æŒ‡æ¨™	    V4 With Filter	   Buy & Hold	   å„ªå‹¢
ç¸½å ±é…¬ç‡	+103.9%	            +93.6%	     âœ… +10.3%
å¹´åŒ–å ±é…¬ç‡	27.3%	            25.1%	       âœ… +2.2%
å¤æ™®æ¯”ç‡	1.84	              1.17	       âœ… +57% é¢¨éšªèª¿æ•´å ±é…¬
æœ€å¤§å›æ’¤	-13.4%	            -28.7%	     âœ… å›æ’¤æ¸›å°‘ 53%

ğŸ“ˆ äº¤æ˜“çµ±è¨ˆ
æŒ‡æ¨™	           æ•¸å€¼
äº¤æ˜“æ¬¡æ•¸	       5 ç­†
å‹ç‡	          100% (5/5)
å¹³å‡å ±é…¬	      +17.7%
å¹³å‡æŒæœ‰å¤©æ•¸	  120 å¤©
è¢«éæ¿¾æ¬¡æ•¸	    68 æ¬¡

ğŸ“Š ä¸‰ç‰ˆæœ¬ç¸¾æ•ˆæ¯”è¼ƒ (V03-03 â†’ V03-04-03 â†’ V03-04-03-test2)

æŒ‡æ¨™	   V03-03	  V03-04-03	V03-04-03-test2	   æœ€ä½³ç‰ˆæœ¬
ç¸½å ±é…¬ç‡	+66.2%	+74.7%	   +103.9%	  ğŸ† V03-04-03-test2  
å¹´åŒ–å ±é…¬ç‡	18.8%	 20.9%	   27.3%	    ğŸ† V03-04-03-test2
å¤æ™®æ¯”ç‡	 1.25	   1.48	     1.84	      ğŸ† V03-04-03-test2
æœ€å¤§å›æ’¤	-17.1%	-17.3%	  -13.4%	    ğŸ† V03-04-03-test2
å‹ç‡	     80%	  80%	      100%  	    ğŸ† V03-04-03-test2
å¹³å‡å ±é…¬	 +12.9%	+14.4%	  +17.7%	    ğŸ† V03-04-03-test2
å¹³å‡æŒæœ‰å¤©æ•¸	106	  111	     120	        -
è¢«éæ¿¾æ¬¡æ•¸	 15	    64	       68	        -

ğŸ“ˆ ç‰ˆæœ¬æ¼”é€²è¶¨å‹¢
ç¸½å ±é…¬ç‡ï¼š66.2% â†’ 74.7% â†’ 103.9%  (æŒçºŒä¸Šå‡ â†‘)
å¤æ™®æ¯”ç‡ï¼š1.25 â†’ 1.48 â†’ 1.84     (æŒçºŒä¸Šå‡ â†‘)
æœ€å¤§å›æ’¤ï¼š-17.1% â†’ -17.3% â†’ -13.4% (ç¬¬ä¸‰ç‰ˆæ˜é¡¯æ”¹å–„)
å‹ç‡ï¼š   80% â†’ 80% â†’ 100%        (ç¬¬ä¸‰ç‰ˆçªç ´)

âœ¨ é—œéµæ”¹é€²åˆ†æ
ç‰ˆæœ¬å‡ç´š	ä¸»è¦æ”¹é€²	å ±é…¬å¢åŠ 
V03-03 â†’ V03-04-03	æ›´ç©æ¥µçš„ Buy Agent & 	æ–°å¢ KD/MACD ç‰¹å¾µ +8.5%
V03-04-03 â†’ V03-04-03-test2	ç§»é™¤T+20å’Œå…¶ä¿¡å¿ƒ ç‰¹å¾µ	+29.2%
ç´¯è¨ˆæ”¹é€²		+37.7%

ğŸ¯ çµè«–
V03-04-03-test2 æ˜¯ç›®å‰æœ€ä½³ç‰ˆæœ¬ï¼š

å ±é…¬æœ€é«˜ (+103.9%)
é¢¨éšªæœ€ä½ (å›æ’¤ -13.4%)
å‹ç‡æœ€é«˜ (100%)
æ¯ç­†äº¤æ˜“è³ºæœ€å¤š (+17.7%)

ç§»é™¤T+20å’Œå…¶ä¿¡å¿ƒ ç‰¹å¾µçš„æ•ˆæœéå¸¸é¡¯è‘—ï¼Œè®“buy agentä¸æœƒéåº¦ä¿å®ˆï¼Œå¸¶ä¾†äº†ç´„ 30% çš„å ±é…¬æå‡ï¼

Note:
- V4: è¨“ç·´æ­¥æ•¸è¨­å®š
PRETRAIN_BUY_STEPS = 1_000_000
PRETRAIN_SELL_STEPS = 500_000
FINETUNE_BUY_STEPS = 1_000_000
FINETUNE_SELL_STEPS = 500_000

- æœ€ä½³æ¨¡å‹æ­¥æ•¸: ä»¥ä¸‹æ˜¯å¾ TensorBoard äº‹ä»¶æª”æ¡ˆä¸­è®€å–çš„ ç²¾ç¢ºæœ€ä½³æ­¥æ•¸
buy: 184è¬æ­¥
sell: 92è¬æ­¥

Agent	 éšæ®µ	      æœ€ä½³æ­¥æ•¸	 æœ€ä½³ Reward	 è©•ä¼°æ¬¡æ•¸
Buy	   Pre-train	560,000	  0.36	        12 æ¬¡
Buy	   Fine-tune	1,280,000	0.03	        25 æ¬¡
Sell	 Pre-train	160,000	  53.50	        6 æ¬¡
Sell	 Fine-tune	320,000	  51.30	        12 æ¬¡

æ ¹æ“šä»¥ä¸Šæ•¸æ“šï¼Œæœ€ä½³æ¨¡å‹å‡ºç¾çš„ä½ç½®ï¼š
Agent	 éšæ®µ	       å»ºè­°è¨­å®š
Buy	   Pre-train	 600,000 (æœ€ä½³åœ¨ 560K)
Buy	   Fine-tune	 300,000 (æœ€ä½³åœ¨ Fine-tune ç¬¬ 280K)
Sell	 Pre-train	 200,000 (æœ€ä½³åœ¨ 160K)
Sell	 Fine-tune	 350,000 (æœ€ä½³åœ¨ 320K)

- æ­£è¦åŒ–æ–¹å¼
ç‰¹å¾µ	       æ­£è¦åŒ–æ–¹æ³•	   æœ€çµ‚å‘½å
K (9,3)	     / 100.0	   Norm_K
D (9,3)	     / 100.0	   Norm_D
DIF (12-26)	 / Close	   Norm_DIF
MACD9	      / Close	     Norm_MACD
OSC	        / Close	     Norm_OSC



# æ²¿ç”¨ v03-04 å¯ä»¥è®€å– å›æ¸¬æŒå€‰ç‹€æ…‹ çš„ ç›¤ä¸­daily_ops_v4_intraday_fixed_lstm.pyï¼Œä¸”æ¡ç”¨äº†å›ºå®šçš„LSTM  backtest_v4_dca_hybrid_with_filter_fixed_lstm.py ä»¥ç¢ºä¿æ¯æ—¥å›æ¸¬çš„çµæœä¸€è‡´ã€‚å› æ­¤å»ºè­°çš„æ“ä½œæµç¨‹ç°¡åŒ–å¦‚ä¸‹:
      ğŸ“… æ¯æ—¥ä¾‹è¡Œå…¬äº‹
      ğŸŒ™ ç›¤å¾Œï¼ˆæ”¶ç›¤å¾ŒåŸ·è¡Œï¼‰
      
      # Step 1: åŸ·è¡Œå›æ¸¬ (æ›´æ–°æŒå€‰åˆ°ä»Šå¤©)
      python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2025-12-09
      
      é€™æœƒï¼š
      ä¸‹è¼‰æœ€æ–°è‚¡åƒ¹è³‡æ–™
      ç”¨å›ºå®š LSTM åŸ·è¡Œå›æ¸¬
      è¼¸å‡ºä»Šæ—¥çš„æŒå€‰ç‹€æ…‹å’Œæ“ä½œå»ºè­°
      æ›´æ–° open_positions_strat2_*.csvï¼ˆä½ çš„ AI æŒå€‰æ˜ç´°ï¼‰

      # Step 2: åŸ·è¡Œ daily_ops_ç›¤å¾Œ (åŸºæ–¼æœ€æ–°æŒå€‰åˆ¤æ–·)
      (è‡ªå‹•é¸æ“‡æœ€æ–°çš„å›æ¸¬æª”æ¡ˆ)
      python daily_ops_v4_fixed_lstm.py
      
      ğŸ¯ å¦‚ä½•æŒ‡å®šç‰¹å®šå›æ¸¬ï¼Ÿ
      æ–¹æ³• 1ï¼šä½¿ç”¨äº’å‹•æ¨¡å¼
      python daily_ops_v4_fixed_lstm.py --interactive

      æ–¹æ³• 2ï¼šæŒ‡å®šå›æ¸¬é–‹å§‹æ—¥æœŸ
      python daily_ops_v4_fixed_lstm.py --backtest-start 2025-12-09

      
      â˜€ï¸ éš”å¤©ç›¤ä¸­ï¼ˆé–‹ç›¤å¾Œä»»æ„æ™‚é–“ï¼‰
      
      # Step 3: åŸ·è¡Œ daily_ops_ç›¤ä¸­ (äº’å‹•é¸å–è¦ç”¨çš„å›æ¸¬)
      python daily_ops_v4_intraday_fixed_lstm.py -i
      
      é€™æœƒï¼š
      æŠ“å–ç›¤ä¸­å³æ™‚åƒ¹æ ¼
      ç”¨ç›¸åŒçš„å›ºå®š LSTM è¨ˆç®—é æ¸¬
      é¡¯ç¤ºæ¯ç­† AI æŒå€‰çš„å³æ™‚å ±é…¬ç‡
      å‘Šè¨´ä½ ä»Šå¤©æ˜¯å¦æ‡‰è©²è²·/è³£

      Fixed LSTM ç›¤ä¸­è…³æœ¬ä¿ç•™äº†å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ï¼š
      # æ–¹å¼ 1: äº’å‹•å¼é¸æ“‡ (ç”¨æ–¹å‘éµ)
      python daily_ops_v4_intraday_fixed_lstm.py -i
      # æ–¹å¼ 2: æŒ‡å®šå›æ¸¬èµ·å§‹æ—¥
      python daily_ops_v4_intraday_fixed_lstm.py --backtest-start 2025-12-09
      # æ–¹å¼ 3: ä½¿ç”¨æœ€æ–° (é è¨­)
      python daily_ops_v4_intraday_fixed_lstm.py

      NOTE: âœ… å·²å¯¦ä½œï¼ç¾åœ¨ daily_ops_v4_intraday_fixed_lstm.py æœƒè‡ªå‹•åŒ¹é…å°æ‡‰çš„ LSTM æ¨¡å‹ï¼šé¸æ“‡å“ªå€‹ CSVï¼Œå°±æœƒè‡ªå‹•è¼‰å…¥å°æ‡‰æ—¥æœŸçš„ Fixed LSTM æ¨¡å‹ï¼é€™æ¨£ä½ å¯ä»¥ä¸¦è¡Œæ¸¬è©¦ä¸åŒæ™‚æœŸçš„ç­–ç•¥ï¼Œæ¯å€‹éƒ½ä½¿ç”¨å„è‡ªæœ€é©åˆçš„æ¨¡å‹ã€‚



    

## âœ¨ æ ¸å¿ƒç‰¹è‰² (Key Features)

| ç‰¹è‰² | èªªæ˜ |
|---------|-------------|
| **æœ¬åœ°è³‡æ–™æ•´åˆ** | TWII æ­·å²è³‡æ–™æ¡æœ¬åœ° CSV ç®¡ç† (`twii_data_from_2000_01_01.csv`)ï¼Œç¢ºä¿æˆäº¤é‡å–®ä½ (å„„å…ƒ) æ­£ç¢ºï¼Œä¸¦å…·å‚™è‡ªå‹•æ›´æ–°æ©Ÿåˆ¶ |
| **åš´è¬¹è¨“ç·´æµç¨‹** | **Data Leakage Prevention**: LSTM æ¨¡å‹è¨“ç·´æ™‚çš„è³‡æ–™ç¸®æ”¾ (Scaling) åš´æ ¼é™åˆ¶åœ¨è¨“ç·´é›†å…§ï¼Œé˜²æ­¢ Look-ahead Bias |
| **LSTM-SSAM é æ¸¬** | T+1 èˆ‡ T+5 åƒ¹æ ¼é æ¸¬ï¼Œä¸¦ä½¿ç”¨ MC Dropout é€²è¡Œä¸ç¢ºå®šæ€§ä¼°è¨ˆ |
| **é·ç§»å­¸ç¿’ (Transfer Learning)** | ä½¿ç”¨å…¨çƒæŒ‡æ•¸é€²è¡Œé è¨“ç·´ (Pre-train) â†’ é‡å° ^TWII é€²è¡Œå¾®èª¿ (Fine-tune) |
| **ç‰¹å¾µèåˆ (Feature Fusion)** | æ•´åˆ 30 ç¨®ç‰¹å¾µï¼ŒåŒ…å« LSTM é æ¸¬ã€ä¿¡å¿ƒåˆ†æ•¸èˆ‡ 6 ç¨®å‡ç·šè¶¨å‹¢ç‰¹å¾µ (Trend/Regime/Bias) |
| **PPO Agent** | åˆ†é›¢çš„è²·å…¥ (Buy) èˆ‡è³£å‡º (Sell) ä»£ç†äººï¼Œä¸¦å…·å‚™é¡åˆ¥å¹³è¡¡æ©Ÿåˆ¶ |
| **å›æ¸¬ (Backtesting)** | å®Œæ•´çš„æ¨¡æ“¬å›æ¸¬ï¼ŒåŒ…å«åœææ©Ÿåˆ¶èˆ‡ç¸¾æ•ˆæŒ‡æ¨™è¨ˆç®— |

## ğŸ“Š ç¸¾æ•ˆçµæœ (2023-Present)

| æŒ‡æ¨™ (Metric) | æ•¸å€¼ (Value) | å‚™è¨» |
|--------|-------|------|
| **ç¸½å ±é…¬ç‡ (Total Return)** | **+47.38%** | Strategy 2 (Shared Pool) |
| **å¹´åŒ–å ±é…¬ç‡ (Annualized)** | **14.09%** | ç©©å¥æˆé•· |
| **å¤æ™®å€¼ (Sharpe Ratio)** | **2.32** ğŸ‘‘ | æ¥µä½³çš„é¢¨éšªèª¿æ•´å›å ± |
| **æœ€å¤§å›æ’¤ (Max Drawdown)** | **-27.8%** | å„ªæ–¼é‡å£“å–®ä¸€ç­–ç•¥ |
| **å‹ç‡ (Win Rate)** | **77.8%** | AI äº¤æ˜“ 45 æ¬¡ (é«˜ä¿¡å¿ƒ) |

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹ (Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HYBRID TRADING SYSTEM                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  LSTM T+1    â”‚    â”‚  LSTM T+5    â”‚    â”‚  LSTM T+20   â”‚      â”‚
â”‚  â”‚   é æ¸¬æ¨¡å‹    â”‚    â”‚  + MC Dropoutâ”‚    â”‚  + MC Dropoutâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                   â”‚                   â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                             â”‚                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚    23 ç‰¹å¾µèåˆ   â”‚                          â”‚
â”‚                    â”‚  (Feature Fusion)â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                             â”‚                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚                                       â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Buy Agent  â”‚                        â”‚  Sell Agent â”‚        â”‚
â”‚  â”‚    (PPO)    â”‚                        â”‚    (PPO)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                                      â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                            â”‚                                     â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                   â”‚    äº¤æ˜“è¨Šè™Ÿ      â”‚                           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å°ˆæ¡ˆçµæ§‹ (Project Structure)

```
hybrid-trader-v03-04/
â”œâ”€â”€ ptrl_hybrid_system.py        # æ ¸å¿ƒç³»çµ± (è³‡æ–™è¼‰å…¥/ç‰¹å¾µè¨ˆç®—/è¨“ç·´é‚è¼¯)
â”œâ”€â”€ update_twii_data.py          # è³‡æ–™æ›´æ–°è…³æœ¬ (è‡ªå‹•æŠ“å–æœ€æ–° TWII æ•¸æ“š)
â”œâ”€â”€ twii_data_from_2000_01_01.csv # æœ¬åœ° TWII æ­·å²è³‡æ–™åº« (Volume: å„„å…ƒ)
â”œâ”€â”€ train_v3_models.py           # V3 è¨“ç·´è…³æœ¬ (Lightweight)
â”œâ”€â”€ train_v4_models.py           # V4 è¨“ç·´è…³æœ¬ (Standard)
â”‚
â”œâ”€â”€ # --- æ¯æ—¥ç¶­é‹è…³æœ¬ ---
â”œâ”€â”€ daily_ops_v4.py              # ç›¤å¾Œåˆ†æ (V4)
â”œâ”€â”€ daily_ops_v4_intraday.py     # ç›¤ä¸­åˆ†æ (Rolling LSTM, æ¯æ¬¡é‡è¨“)
â”œâ”€â”€ daily_ops_v4_intraday_fixed_lstm.py  # â­ ç›¤ä¸­åˆ†æ (Fixed LSTM, ç„¡é‡è¨“)
â”œâ”€â”€ daily_ops_dual.py            # é›™ç­–ç•¥æ¯”è¼ƒ (V3+V4)
â”‚
â”œâ”€â”€ # --- å›æ¸¬è…³æœ¬ ---
â”œâ”€â”€ backtest_v4_no_filter.py     # V4 ç„¡æ¿¾ç¶²å›æ¸¬
â”œâ”€â”€ backtest_v4_with_filter.py   # V4 æœ‰æ¿¾ç¶²å›æ¸¬
â”œâ”€â”€ backtest_v4_dca_hybrid_no_filter.py  # DCA æ··åˆç„¡æ¿¾ç¶²
â”œâ”€â”€ backtest_v4_dca_hybrid_with_filter_rolling_lstm.py  # DCA+æ¿¾ç¶²+Rolling LSTM
â”œâ”€â”€ backtest_v4_dca_hybrid_with_filter_fixed_lstm.py    # â­ DCA+æ¿¾ç¶²+Fixed LSTM (æ¨è–¦)
â”‚
â””â”€â”€ # --- è¼¸å‡ºç›®éŒ„ ---
    â”œâ”€â”€ results_backtest_v4_dca_hybrid_with_filter_fixed_lstm/  # Fixed LSTM å›æ¸¬çµæœ
    â”œâ”€â”€ intraday_runs_v4_fixed/                                  # Fixed LSTM ç›¤ä¸­å ±å‘Š
    â””â”€â”€ saved_models_*/                                          # LSTM æ¨¡å‹å„²å­˜
```

## ğŸ› ï¸ å®‰è£èªªæ˜ (Installation)

### å»ºè­°ä½¿ç”¨è™›æ“¬ç’°å¢ƒ (Virtual Environment)
åœ¨ Windows ä¸Šä½¿ç”¨è™›æ“¬ç’°å¢ƒå¯ä»¥é¿å…å¥—ä»¶ç‰ˆæœ¬è¡çªï¼Œå¼·çƒˆå»ºè­°ä½¿ç”¨ã€‚

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªå‹•è…³æœ¬ (æ¨è–¦)**
```powershell
.\setup_env.ps1
```

**æ–¹æ³•äºŒï¼šæ‰‹å‹•è¨­å®š**
```powershell
# 1. å»ºç«‹è™›æ“¬ç’°å¢ƒ
python -m venv venv

# 2. å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
.\venv\Scripts\Activate.ps1

# 3. å®‰è£å¥—ä»¶
pip install -r requirements.txt
```

### âš¡ GPU åŠ é€Ÿè¨­å®š (é‡è¦)
æœ¬å°ˆæ¡ˆå»ºè­°ä½¿ç”¨ NVIDIA é¡¯å¡é€²è¡Œè¨“ç·´åŠ é€Ÿã€‚

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ setup_env.ps1 (è‡ªå‹•)**
è…³æœ¬æœƒè‡ªå‹•å®‰è£æ”¯æ´ CUDA 11.8 çš„ PyTorch ç‰ˆæœ¬ã€‚

**æ–¹æ³•äºŒï¼šæ‰‹å‹•å®‰è£**
è‹¥æ‚¨æ‰‹å‹•åŸ·è¡Œ `pip install -r requirements.txt`ï¼Œé è¨­æœƒå®‰è£ CPU ç‰ˆæœ¬ã€‚è«‹åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å°‡å…¶æ›¿æ›ç‚º GPU ç‰ˆæœ¬ï¼š

```powershell
# 1. ç§»é™¤ CPU ç‰ˆæœ¬
pip uninstall torch torchvision torchaudio -y

# 2. å®‰è£ GPU ç‰ˆæœ¬ (CUDA 11.8)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### ç³»çµ±éœ€æ±‚ (Dependencies)

```
tensorflow>=2.10
stable-baselines3>=2.0
gymnasium
yfinance
pandas
numpy>=2.0 (V4 Models Compatibility)
ta
torch
tqdm
matplotlib
psutil
```

## ğŸš€ å¿«é€Ÿé–‹å§‹ (Quick Start)

### 1. è¨“ç·´ LSTM æ¨¡å‹ (é•·é€±æœŸ)

```bash
python train_lstm_models.py
```

### 2. è¨“ç·´ RL æ¨¡å‹ (V3 vs V4)

æœ¬å°ˆæ¡ˆæä¾›å…©å€‹ç‰ˆæœ¬çš„ RL è¨“ç·´è…³æœ¬ï¼Œè«‹ä¾éœ€æ±‚é¸æ“‡ï¼š

| ç‰¹æ€§ | V3 (Lightweight) | V4 (Standard) |
|------|------------------|---------------|
| **ç”¨é€”** | è¼•é‡ç‰ˆï¼Œé©åˆå¿«é€Ÿå¯¦é©— | æ¨™æº–ç‰ˆï¼Œé©åˆå®Œæ•´è¨“ç·´ |
| **Buy Fine-tune** | 200,000 æ­¥ | 1,000,000 æ­¥ |
| **Sell Fine-tune** | 100,000 æ­¥ | 300,000 æ­¥ |
| **æŒ‡ä»¤** | `python train_v3_models.py` | `python train_v4_models.py` |
| **è¼¸å‡ºç›®éŒ„** | `models_hybrid_v3/` | `models_hybrid_v4/` |

### 3. æ¯æ—¥ç¶­é‹ (Daily Operations)

è‡ªå‹•åŒ–è…³æœ¬èƒ½å®Œæˆã€ŒLSTM è¼‰å…¥/è¨“ç·´ â†’ ç‰¹å¾µå·¥ç¨‹ â†’ RL æ¨è«– â†’ å ±å‘Šç”Ÿæˆã€å…¨æµç¨‹ã€‚

#### â­ æ¨è–¦å·¥ä½œæµç¨‹ï¼šFixed LSTM (çµæœä¸€è‡´)

ä½¿ç”¨å›ºå®š LSTM æ¨¡å‹ï¼Œç¢ºä¿å›æ¸¬èˆ‡ç›¤ä¸­åˆ†æä½¿ç”¨ç›¸åŒæ¨¡å‹ï¼Œçµæœå®Œå…¨å¯é‡ç¾ã€‚

**Step 1: ç›¤å¾ŒåŸ·è¡Œå›æ¸¬**
```bash
python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2025-01-02
```
- é¦–æ¬¡åŸ·è¡Œï¼šè¨“ç·´ä¸¦å„²å­˜ `_fixed` å¾Œç¶´çš„ LSTM æ¨¡å‹
- å¾ŒçºŒåŸ·è¡Œï¼šè‡ªå‹•ä½¿ç”¨ç¾æœ‰ `_fixed` æ¨¡å‹ï¼Œç„¡éœ€é‡è¨“
- è¼¸å‡ºï¼š`lstm_info_*.json`ã€`open_positions_strat2_*.csv`

**Step 2: ç›¤ä¸­å³æ™‚åˆ†æ**
```bash
python daily_ops_v4_intraday_fixed_lstm.py        # ä½¿ç”¨æœ€æ–°å›æ¸¬çµæœ
python daily_ops_v4_intraday_fixed_lstm.py -i     # äº’å‹•é¸æ“‡å›æ¸¬ CSV
python daily_ops_v4_intraday_fixed_lstm.py --backtest-start 2025-01-02  # æŒ‡å®šèµ·å§‹æ—¥
```
- è®€å– `lstm_info_*.json`ï¼Œè¼‰å…¥èˆ‡å›æ¸¬ç›¸åŒçš„ LSTM æ¨¡å‹
- æ ¹æ“šé¸æ“‡çš„ CSV è‡ªå‹•åŒ¹é…å°æ‡‰çš„ LSTM æ¨¡å‹
- é¡¯ç¤ºæ¯ç­† AI æŒå€‰çš„å³æ™‚å ±é…¬ç‡èˆ‡åœæ/åœåˆ©é æ¸¬

**è¼¸å‡ºç›®éŒ„**ï¼š
```
results_backtest_v4_dca_hybrid_with_filter_fixed_lstm/
â”œâ”€â”€ daily_action_strat2_*.csv     # æ¯æ—¥æ“ä½œæ‘˜è¦
â”œâ”€â”€ open_positions_strat2_*.csv   # æœªå¹³å€‰ AI æŒå€‰
â””â”€â”€ lstm_info_*.json              # ä½¿ç”¨çš„ LSTM æ¨¡å‹è·¯å¾‘

intraday_runs_v4_fixed/YYYY-MM-DD_HHMMSS/
â””â”€â”€ reports/
    â”œâ”€â”€ intraday_summary.txt
    â””â”€â”€ intraday_summary.json
```

---

#### ğŸ“Œ å‚³çµ±å·¥ä½œæµç¨‹ (Rolling LSTM)

æ¯æ¬¡åŸ·è¡Œéƒ½é‡æ–°è¨“ç·´ LSTMï¼Œé©åˆéœ€è¦æœ€æ–°æ¨¡å‹çš„æƒ…å¢ƒã€‚

- **ç›¤å¾Œåˆ†æ**:
  ```bash
  python daily_ops_v4.py           # V4 å–®ç­–ç•¥
  python daily_ops_dual.py         # V3+V4 é›™ç­–ç•¥æ¯”è¼ƒ
  ```

- **ç›¤ä¸­å³æ™‚åˆ†æ** (æ¯æ¬¡é‡è¨“ LSTMï¼Œç´„ 20-40 åˆ†é˜):
  ```bash
  python daily_ops_v4_intraday.py    # V4 å°ˆç”¨ (å« T+20/T+5/T+1)
  python daily_ops_dual_intraday.py  # é›™ç­–ç•¥æ¯”è¼ƒç‰ˆ 
  ```

**æµç¨‹èªªæ˜ï¼š**
1. å¾**è­‰äº¤æ‰€ç›¤ä¸­ API** (`mis.twse.com.tw`) ä¸‹è¼‰ç•¶æ—¥å³æ™‚ OHLC
2. ä½¿ç”¨ CSV å‰ 5 æ—¥æˆäº¤é‡å¹³å‡ä½œç‚ºç•¶æ—¥é ä¼°æˆäº¤é‡
3. ä½¿ç”¨ä¸Šè¿°è³‡æ–™å®Œæ•´è¨“ç·´ LSTM æ¨¡å‹ (T+20, T+5, T+1)
4. é€²è¡Œ RL æ¨è«–ä¸¦è¼¸å‡ºå ±å‘Š

---

**åŠŸèƒ½ç‰¹é»ï¼š**
- **å…¨æ™‚æ¨è«–æ¨¡å¼**: ç„¡è«– Donchian æ¿¾ç¶²ç‹€æ…‹ï¼ŒAI éƒ½æœƒåŸ·è¡Œé æ¸¬ä¸¦é¡¯ç¤ºæ„åœ–
- **æ¿¾ç¶²ç‹€æ…‹æ¨™è¨˜**: `BUY`, `WAIT`, `FILTERED (AI: BUY)`, `FILTERED (AI: WAIT)`
- **æƒ…å¢ƒåˆ†æ**: Sell Agent é‡å°ä¸‰ç¨®æŒå€‰æƒ…å¢ƒ (æˆæœ¬å€/ç²åˆ©+10%/è™§æ-5%) æä¾›å»ºè­°
- **æŒå€‰æ˜ç´°**: é¡¯ç¤ºæ¯ç­† AI æŒå€‰çš„è²·å…¥åƒ¹æ ¼ã€ç•¶å‰å ±é…¬ç‡ã€åœæ/åœåˆ©ç‹€æ…‹
- è¼¸å‡º JSON èˆ‡ TXT æˆ°æƒ…å ±å‘Š

### 4. ç­–ç•¥å›æ¸¬ (Backtesting)

æœ¬ç³»çµ±æä¾›å…©ç¨® V4 ç­–ç•¥å›æ¸¬æ¨¡å¼ï¼Œæ–¹ä¾¿è©•ä¼°æ¿¾ç¶²æ•ˆç›Šï¼š

#### A. ç„¡æ¿¾ç¶²æ¨¡å¼ (Aggressive)
æ¸¬è©¦ AI åœ¨**æ¯å¤©éƒ½å¯é€²å ´** (ç„¡ Donchian æ¿¾ç¶²é™åˆ¶) çš„ç¸¾æ•ˆï¼Œè©•ä¼° AI æœ¬èº«çš„åˆ¤æ–·èƒ½åŠ›ã€‚
```bash
python backtest_v4_no_filter.py
```

#### B. æœ‰æ¿¾ç¶²æ¨¡å¼ (Strict)
æ¸¬è©¦ AI åœ¨**åš´æ ¼éµå®ˆæ¿¾ç¶²** (åƒ… Donchian é€šé“çªç ´æ—¥) ä¸‹çš„ç¸¾æ•ˆï¼Œè©•ä¼°æ¿¾ç¶²éæ¿¾é›œè¨Šçš„æ•ˆæœã€‚
```bash
python backtest_v4_with_filter.py
```

**âœ¨ å›æ¸¬ç³»çµ±ç‰¹è‰²ï¼š**

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| **ä¿¡å¿ƒåº¦å¯è¦–åŒ–** | åœ–è¡¨ä¸Šç›´æ¥æ¨™è¨» AI è²·è³£é»çš„ä¿¡å¿ƒåº¦æ•¸å€¼ (%) |
| **æ¯æ—¥ä¿¡å¿ƒè¨˜éŒ„** | è¼¸å‡º `daily_confidence_*.csv`ï¼Œå®Œæ•´è¨˜éŒ„æ¯æ—¥ AI ä¿¡å¿ƒèˆ‡æ±ºç­– |
| **è‡ªè¨‚æ—¥æœŸç¯„åœ** | é€é `--start` å’Œ `--end` åƒæ•¸æŒ‡å®šå›æ¸¬æœŸé–“ |
| **å‹•æ…‹æª”å** | è¼¸å‡ºæª”æ¡ˆè‡ªå‹•åŒ…å«æ—¥æœŸç¯„åœï¼Œé¿å…è¦†è“‹ |
| **Benchmark æ¯”è¼ƒ** | ç­–ç•¥ç¸¾æ•ˆ vs Buy & Hold ä¸¦æ’é¡¯ç¤º |

### 5. DCA + AI æ··åˆç­–ç•¥å›æ¸¬

æ¸¬è©¦ã€Œå®šæœŸå®šé¡ + AI è‡ªç”±æ“ä½œã€æ··åˆç­–ç•¥çš„ç¸¾æ•ˆã€‚

#### â­ æ¨è–¦ï¼šFixed LSTM ç‰ˆæœ¬ (çµæœä¸€è‡´)

```bash
python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2025-01-02
```

- ä½¿ç”¨å›ºå®š LSTM æ¨¡å‹ï¼Œæ¯æ¬¡åŸ·è¡Œçµæœå®Œå…¨ä¸€è‡´
- é¦–æ¬¡åŸ·è¡Œè¨“ç·´ä¸¦å„²å­˜ `_fixed` æ¨¡å‹ï¼Œå¾ŒçºŒè‡ªå‹•ä½¿ç”¨
- è¼¸å‡º `lstm_info_*.json` ä¾›ç›¤ä¸­è…³æœ¬è®€å–
- è¼¸å‡º `open_positions_strat2_*.csv` è¨˜éŒ„ AI æŒå€‰æ˜ç´°

#### Rolling LSTM ç‰ˆæœ¬ (æ¯æ¬¡é‡è¨“)

```bash
python backtest_v4_dca_hybrid_with_filter_rolling_lstm.py --start 2025-01-02  # æœ‰æ¿¾ç¶²
python backtest_v4_dca_hybrid_no_filter.py                                     # ç„¡æ¿¾ç¶²
```

**ç­–ç•¥èªªæ˜ï¼š**
1. **Strategy 1: Split 50/50 (è³‡é‡‘å°åŠåˆ†é…)**
   - æ¯å¹´å¹´åˆç²å¾—é¡åº¦ (External Limit) 60 è¬ã€‚
   - é¡åº¦å°åŠæ‹†åˆ†: DCA 30 è¬ (æ¯æœˆ2.5è¬)ï¼ŒAI 30 è¬ã€‚
   - **AI All-in**: ç•¶ AI æ±ºå®šè²·å…¥æ™‚ï¼ŒæœƒæŠ•å…¥ **100%** çš„å¯ç”¨è³‡é‡‘ã€‚

2. **Strategy 2: Shared Pool (è³‡é‡‘æ± å…±äº«)** - **Recommended**
   - æ¯å¹´å¹´åˆç²å¾— 60 è¬é¡åº¦ï¼Œç”± DCA èˆ‡ AI å…±äº«ã€‚
   - **å„ªå…ˆé †åº**: æ¯æœˆ DCA (5è¬) å„ªå…ˆä½¿ç”¨å…§éƒ¨ç¾é‡‘æˆ–é¡åº¦ï¼Œå‰©é¤˜è³‡é‡‘ä¾› AI (æ¯æ¬¡5è¬) ä½¿ç”¨ã€‚
   - **è³‡é‡‘å¾ªç’°**: AI è³£å‡ºå¾Œè³‡é‡‘å›æµè‡³å…§éƒ¨ç¾é‡‘æ± ï¼Œå¯ä¾› DCA æˆ– AI å†æ¬¡ä½¿ç”¨ã€‚

**æ¯”è¼ƒåŸºæº–ï¼š**
1. ç´”å®šæœŸå®šé¡ï¼šæ¯æœˆ 5 è¬å…ƒ (Pure DCA)
2. å¹´åˆä¸€æ¬¡æŠ•å…¥ï¼šæ¯å¹´ 60 è¬ Buy & Hold (Yearly Lump Sum)

**è¼¸å‡ºæª”æ¡ˆ (v3.1 æ›´æ–°)ï¼š**
```
results_backtest_v4_dca_hybrid_no_filter/
â”œâ”€â”€ backtest_comparison_*.png (ç­–ç•¥æ¯”è¼ƒåœ–è¡¨)
â”œâ”€â”€ metrics_comparison_*.csv (ç¸¾æ•ˆæŒ‡æ¨™æ¯”è¼ƒè¡¨)
â”œâ”€â”€ trades_strat1_*.csv (Strategy 1 AI äº¤æ˜“ç´€éŒ„)
â”œâ”€â”€ trades_strat2_*.csv (Strategy 2 AI äº¤æ˜“ç´€éŒ„)
â”œâ”€â”€ daily_confidence_strat1_*.csv (S1 æ¯æ—¥ä¿¡å¿ƒèˆ‡ Action)
â””â”€â”€ daily_confidence_strat2_*.csv (S2 æ¯æ—¥ä¿¡å¿ƒèˆ‡ Action)
```
*è¨»ï¼š`daily_confidence` æª”æ¡ˆåŒ…å« `action` æ¬„ä½ (BUY/SELL/hold/wait) ä¾›è©³ç´°æª¢è¦– AI æ±ºç­–ã€‚*

### ğŸ” å›æ¸¬è…³æœ¬åŠŸèƒ½æ¯”è¼ƒ

| åŠŸèƒ½ | `no_filter` | `with_filter` | `dca_hybrid_no_filter` | `dca_hybrid_fixed_lstm` â­ |
|------|:---:|:---:|:---:|:---:|
| è‡ªè¨‚æ—¥æœŸç¯„åœ | âœ… | âœ… | âœ… | âœ… |
| DCA + AI æ··åˆ | âŒ | âŒ | âœ… | âœ… |
| Donchian æ¿¾ç¶² | âŒ | âœ… | âŒ | âœ… |
| **Fixed LSTM** | âŒ | âŒ | âŒ | âœ… |
| AI æŒå€‰æ˜ç´°è¼¸å‡º | âŒ | âŒ | âŒ | âœ… |
| ç›¤ä¸­è…³æœ¬æ•´åˆ | âŒ | âŒ | âŒ | âœ… |

> [!IMPORTANT]
> **æ¨è–¦ä½¿ç”¨ Fixed LSTM ç‰ˆæœ¬**ï¼š`backtest_v4_dca_hybrid_with_filter_fixed_lstm.py` å¯ç¢ºä¿å›æ¸¬èˆ‡ç›¤ä¸­åˆ†æä½¿ç”¨ç›¸åŒ LSTM æ¨¡å‹ï¼Œçµæœå®Œå…¨ä¸€è‡´ã€‚

## ğŸ“ˆ è¨“ç·´æµç¨‹ (Training Pipeline)

### Phase 1: æ•¸æ“šæ•´åˆ (Unified Data Source)
- **æœ¬åœ°æ•¸æ“š**: ^TWII ä½¿ç”¨æœ¬åœ° `twii_data_from_2000_01_01.csv`ï¼Œç¢ºä¿æˆäº¤é‡å–®ä½æ­£ç¢º (å„„å…ƒ)ã€‚
- **è‡ªå‹•æ›´æ–°**: ç³»çµ±è‡ªå‹•æª¢æŸ¥ä¸¦é€é `update_twii_data.py` è£œé½Šæœ€æ–°äº¤æ˜“æ—¥è³‡æ–™ã€‚
- **åœ‹éš›æŒ‡æ•¸**: ä¸‹è¼‰ 4 å€‹å…¨çƒæŒ‡æ•¸ï¼š^GSPC, ^IXIC, ^SOX, ^DJI (from yfinance)
- **å½±éŸ¿ç¯„åœ**: æ¶µè“‹ V3/V4 è¨“ç·´ã€æ‰€æœ‰å›æ¸¬è…³æœ¬ä»¥åŠæ¯æ—¥ç¶­é‹è…³æœ¬ (Daily Ops)ã€‚

### Phase 2: ç‰¹å¾µå·¥ç¨‹ (Feature Engineering)
- åŒ…å« 24 ç¨®ç‰¹å¾µ (v3.0 æ›´æ–°)ï¼š
  - æ¨™æº–åŒ– OHLC åƒ¹æ ¼
  - å”å¥‡å®‰é€šé“ (Donchian Channel)ã€è¶…ç´šè¶¨å‹¢ (SuperTrend)
  - å¹³å‡Kç·š (Heikin-Ashi) å‹æ…‹
  - RSI, MFI, ATR æŒ‡æ¨™
  - ç›¸å°å¼·åº¦ (Relative Strength) æŒ‡æ¨™
  - **LSTM_Pred_1d**: T+1 é æ¸¬æ¼²å¹…
  - **LSTM_Conf_1d**: T+1 ä¿¡å¿ƒåº¦ (MC Dropout) âœ¨ NEW
  - **LSTM_Pred_5d**: T+5 é æ¸¬æ¼²å¹…
  - **LSTM_Conf_5d**: T+5 ä¿¡å¿ƒåº¦ (MC Dropout)
  - **LSTM_Pred_20d**: T+20 é æ¸¬æ¼²å¹… (New!)
  - **LSTM_Conf_20d**: T+20 ä¿¡å¿ƒåº¦ (MC Dropout) (New!)
  - **[V4.1] é¡¯æ€§ç‰¹å¾µ (Explicit Features)**:
    - `MA20_Slope`: çŸ­æœŸè¶¨å‹¢å‹•èƒ½
    - `Trend_Gap`: å¸‚å ´é«”åˆ¶ (çŸ­é•·ç·šä¹–é›¢)
    - `Bias_MA20`: çŸ­ç·šä¹–é›¢ç‡
    - `Dist_MA60`: å­£ç·šæ”¯æ’è·é›¢
    - `Dist_MA240`: å¹´ç·šç”Ÿå‘½ç·šä½ç½®
    - `Vol_Ratio`: ç›¸å°é‡èƒ½ (RVol)

### Phase 3: é è¨“ç·´ (Pre-training)
- Buy Agent: 1,000,000 æ­¥ (é¡åˆ¥å¹³è¡¡æ¡æ¨£)
- Sell Agent: 500,000 æ­¥

### Phase 4: å¾®èª¿èˆ‡å›æ¸¬ (Fine-tuning & Backtesting)
- å¾®èª¿ï¼šé‡å° ^TWII (2000-2022) é€²è¡Œè¨“ç·´ï¼ŒLearning Rate = 1e-5
- å›æ¸¬ï¼šé©—è­‰æ•¸æ“šé›† (2023-Present)

### âš ï¸ è³‡æ–™ç´€å¾‹ (Data Discipline)

> [!IMPORTANT]
> **é˜²æ­¢è³‡æ–™æ´©æ¼ (Data Leakage Prevention)**
> 
> æœ¬ç³»çµ±æ¡ç”¨åš´æ ¼çš„æ™‚é–“åˆ‡åˆ†ç­–ç•¥ï¼Œç¢ºä¿æ¨¡å‹åœ¨è¨“ç·´æ™‚ä¸æœƒçœ‹åˆ°é©—è­‰æœŸçš„è³‡æ–™ã€‚

| éšæ®µ | è³‡æ–™ç¯„åœ | èªªæ˜ |
|------|----------|------|
| **LSTM è¨“ç·´** | 2000-01-01 ~ 2022-12-31 | ä½¿ç”¨ `train_lstm_models.py` è¨­å®šçš„ `TRAIN_END` |
| **RL é è¨“ç·´** | 2000-01-01 ~ 2022-12-31 | å…¨çƒæŒ‡æ•¸ (^TWII, ^GSPC, ^IXIC, ^SOX, ^DJI) æˆªæ­¢æ–¼ `SPLIT_DATE` |
| **RL å¾®èª¿** | ^TWII < 2023-01-01 | åªç”¨ `SPLIT_DATE` ä¹‹å‰çš„ TWII è³‡æ–™ |
| **RL é©—è­‰/å›æ¸¬** | ^TWII >= 2023-01-01 | æ¨¡å‹å®Œå…¨æ²’è¦‹éçš„è³‡æ–™ |

> [!NOTE]
> **T+20 è¨“ç·´é›†åˆ‡åˆ†ç­–ç•¥ (Adaptive Split)**
> T+20 æ¨¡å‹ç‚ºäº†æ•æ‰æœ€æ–°çš„å¸‚å ´è¶¨å‹¢ï¼Œé è¨­ä½¿ç”¨ **99%** çš„æ­·å²è³‡æ–™é€²è¡Œè¨“ç·´ã€‚
> è‹¥ 99% åˆ‡åˆ†å°è‡´é©—è­‰é›†ä¸è¶³ (å› ç‚º T+20 éœ€è¦æœªä¾†æ¨™ç±¤)ï¼Œç³»çµ±æœƒè‡ªå‹•èª¿æ•´ç­–ç•¥ï¼Œ**å¼·åˆ¶ä¿ç•™æœ€å¾Œ 20 ç­†è³‡æ–™**ä½œç‚ºé©—è­‰é›†ï¼Œè€Œä¸æ˜¯å›é€€åˆ°å‚³çµ±çš„ 80/20 åˆ‡åˆ†ã€‚é€™ç¢ºä¿äº†æ¨¡å‹èƒ½å­¸ç¿’åˆ°æœ€å®Œæ•´çš„è¿‘æœŸèµ°å‹¢ã€‚

**é—œéµè¨­å®š (2025-12-11 æ›´æ–°)ï¼š**
```python
# train_lstm_models.py
TRAIN_END = "2022-12-31"

# train_v3_models.py / train_v4_models.py
SPLIT_DATE = '2023-01-01'
raw_data = hybrid.fetch_index_data(DATA_PATH, start_date="2000-01-01", end_date=SPLIT_DATE)
```

**æ™‚é–“ç·šè¦–è¦ºåŒ–ï¼š**
```
LSTM è¨“ç·´æœŸ:      2000 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2022-12-31
RL è¨“ç·´/å¾®èª¿æœŸ:   2000 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2022-12-31
                                                     â”‚
RL é©—è­‰/å›æ¸¬æœŸ:                                2023-01-01 â”€â”€â”€â”€â”€â”€â”€ ä»Šå¤©
                                               (æ¨¡å‹æœªè¦‹é)
```

### Phase 5: è¨“ç·´ç›£æ§ (Training Monitoring)
æœ¬ç³»çµ±æ•´åˆäº† **TensorBoard** é€²è¡Œè¨“ç·´éç¨‹çš„å³æ™‚ç›£æ§ã€‚

**è‡ªå‹•è¨˜éŒ„çš„æŒ‡æ¨™ï¼š**
- `rollout/ep_rew_mean`: å¹³å‡çå‹µ
- `train/loss`: ç¸½æå¤±
- `train/policy_gradient_loss`: ç­–ç•¥æ¢¯åº¦æå¤±
- `train/value_loss`: åƒ¹å€¼å‡½æ•¸æå¤±
- `train/entropy_loss`: ç†µæå¤±
- `eval/mean_reward`: é©—è­‰é›†å¹³å‡çå‹µ (EvalCallback)

**å¦‚ä½•ä½¿ç”¨ TensorBoardï¼š**
```powershell
# åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹åŸ·è¡Œ
tensorboard --logdir ./tensorboard_logs/

# ç„¶å¾Œé–‹å•Ÿç€è¦½å™¨å‰å¾€
# http://localhost:6006
```

**æ—¥èªŒå­˜æ”¾ä½ç½®ï¼š**
- `./tensorboard_logs/`: TensorBoard æ—¥èªŒ
- `./logs/`: EvalCallback è©•ä¼°çµæœ
- `models_hybrid/best_tuned/`: é©—è­‰é›†æœ€ä½³æ¨¡å‹

---

## ğŸ“Š è¼¸å‡ºçµæœ (Output)

åŸ·è¡Œ `ptrl_hybrid_system.py` å¾Œï¼Œæ‚¨å°‡ç²å¾—ï¼š

- `models_hybrid/ppo_buy_twii_final.zip`: å¾®èª¿å¾Œçš„ Buy Model
- `models_hybrid/ppo_sell_twii_final.zip`: å¾®èª¿å¾Œçš„ Sell Model
- `results_hybrid/final_performance.png`: ç¸¾æ•ˆåœ–è¡¨
- `tensorboard_logs/`: è¨“ç·´éç¨‹æ—¥èªŒ (å¯ç”¨ TensorBoard æŸ¥çœ‹)

## ğŸ”§ V3 vs V4 ç‰ˆæœ¬æ¯”è¼ƒ

| é …ç›® | V3 (Lightweight) | V4 (Standard) | åŸå§‹ç‰ˆ (ptrl_hybrid_system.py) |
|-----|------------------|-----------------|--------------------------------|
| **Pre-train Buy** | 1,000,000 | 1,000,000 | 1,000,000 |
| **Pre-train Sell** | 500,000 | 500,000 | 500,000 |
| **Fine-tune Buy** | **200,000** | **1,000,000** | 1,000,000 |
| **Fine-tune Sell** | **100,000** | **300,000** | 300,000 |
| **ä¿¡å¿ƒåº¦é–€æª»** | [0.001, 0.010] v2.5 | [0.001, 0.010] v2.5 | [0.005, 0.015] (èˆŠç‰ˆ) |
| **ç‰¹å¾µå¿«å–** | å¼·åˆ¶æ¸…é™¤ | å¼·åˆ¶æ¸…é™¤ | ä½¿ç”¨å¿«å– (éœ€æ‰‹å‹•æ¸…é™¤) |
| **æ¨¡å‹è·¯å¾‘** | `models_hybrid_v3` | `models_hybrid_v4` | `models_hybrid` |

---

## ğŸ”® LSTM ä¿¡å¿ƒåº¦è§£è®€æŒ‡å— (Confidence Interpretation)

### è¨ˆç®—åŸç† (Methodology)
ä¿¡å¿ƒåº¦ (`LSTM_Conf_1d`, `LSTM_Conf_5d`) æ˜¯åŸºæ–¼ **è’™åœ°å¡ç¾… Dropout (MC Dropout)** è¨ˆç®—çš„ï¼š
1. å°åŒä¸€ç­†è³‡æ–™é€²è¡Œ 30 æ¬¡é æ¸¬ï¼ˆæ¯æ¬¡ Dropout éš¨æ©Ÿé®è”½ä¸åŒç¥ç¶“å…ƒï¼‰
2. è¨ˆç®—é€™ 30 æ¬¡é æ¸¬çš„**è®Šç•°ä¿‚æ•¸ (CV)** = æ¨™æº–å·® Ã· å¹³å‡å€¼
3. CV è¶Šå° â†’ æ¨¡å‹è¶Šç©©å®š â†’ ä¿¡å¿ƒåº¦è¶Šé«˜

### é–€æª»è¨­å®š (v3.0)

| æ¨¡å‹ | threshold_high | threshold_low | èªªæ˜ |
|------|----------------|---------------|------|
| **T+1** | 0.008 (0.8%) | 0.040 (4.0%) | ç¯„åœè¼ƒå¯¬ï¼Œé©æ‡‰è¼ƒé«˜çš„ CV åˆ†ä½ˆ |
| **T+5** | 0.001 (0.1%) | 0.010 (1.0%) | ç¯„åœè¼ƒçª„ï¼Œæ¨¡å‹æœ¬èº«è¼ƒç©©å®š |
| **T+20**| 0.010 (1.0%) | 0.030 (3.0%) | é•·é€±æœŸä¸ç¢ºå®šæ€§é«˜ï¼Œé–€æª»é©åº¦æ”¾å¯¬ |

```python
# ptrl_hybrid_system.py add_lstm_features()
# T+1 ä¿¡å¿ƒåº¦
score_1d = 1.0 - (cv - 0.008) / (0.040 - 0.008)
conf_1d = np.clip(score_1d, 0.0, 1.0)

# T+5 ä¿¡å¿ƒåº¦
score_5d = 1.0 - (cv - 0.001) / (0.010 - 0.001)
conf_5d = np.clip(score_5d, 0.0, 1.0)

# T+20 ä¿¡å¿ƒåº¦
score_20d = 1.0 - (cv - 0.010) / (0.030 - 0.010)
conf_20d = np.clip(score_20d, 0.0, 1.0)
```

### åˆ†æ•¸å°ç…§è¡¨

| ä¿¡å¿ƒåº¦ | è§£è®€ | å»ºè­° |
|--------|------|------|
| **0.8+** | ğŸŸ¢ **é«˜ä¿¡å¿ƒ** - æ¨¡å‹éå¸¸ç¢ºå®š | é æ¸¬å¯é åº¦é«˜ï¼Œå¯ä½œç‚ºä¸»è¦åƒè€ƒ |
| **0.6-0.8** | ğŸŸ¡ **ä¸­ç­‰åé«˜** - æ­£å¸¸æ°´æº– | é æ¸¬å¯åƒè€ƒï¼Œä½†éœ€çµåˆå…¶ä»–æŒ‡æ¨™ |
| **0.4-0.6** | ğŸŸ¡ **ä¸­ç­‰** - ç•¥æœ‰ä¸ç¢ºå®šæ€§ | é æ¸¬åƒ…ä¾›è¼”åŠ©åƒè€ƒ |
| **< 0.4** | ğŸ”´ **ä½ä¿¡å¿ƒ** - æ¨¡å‹ä¸ç¢ºå®š | é æ¸¬ä¸ç©©å®šï¼Œè¬¹æ…æ¡ä¿¡ |

### å¯¦éš›æ‡‰ç”¨å»ºè­°
1. **ä¿¡å¿ƒåº¦ 0.8+**ï¼šå¯ä»¥æ›´ç©æ¥µåœ°åƒè€ƒ LSTM çš„æ¼²è·Œé æ¸¬
2. **ä¿¡å¿ƒåº¦ 0.6-0.8**ï¼šé æ¸¬æ–¹å‘å¯åƒè€ƒï¼Œä½†é»ä½é ä¼°éœ€æ‰“æŠ˜æ‰£
3. **ä¿¡å¿ƒåº¦ 0.4-0.6**ï¼šé æ¸¬åƒ…ä¾›è¼”åŠ©åƒè€ƒï¼Œå»ºè­°æ­é…å…¶ä»–æŠ€è¡“æŒ‡æ¨™
4. **ä¿¡å¿ƒåº¦ < 0.4**ï¼šæ¨¡å‹å°ç•¶å¤©çš„åˆ¤æ–·è¼ƒä¸ç¢ºå®šï¼Œå¯èƒ½æ˜¯å› ç‚ºå¸‚å ´è™•æ–¼ç•°å¸¸æ³¢å‹•æœŸ

---

## ğŸ“š åƒè€ƒæ–‡ç» (References)

- **Pro Trader RL**: [Paper Implementation](https://arxiv.org/abs/xxxx)
- **LSTM-SSAM**: Sequential Self-Attention for time series prediction
- **MC Dropout**: Uncertainty estimation via Monte Carlo Dropout

## ğŸ“„ æˆæ¬Š (License)

MIT License

## ğŸ‘¤ ä½œè€… (Author)

Phil Liang

---

*Built with Python, TensorFlow, Stable-Baselines3, and â¤ï¸*
